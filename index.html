<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>غرفة تركيز | Focus Room</title>
    <meta name="description" content="غرفة تركيز - مساحتك الشخصية للتركيز والإنتاجية مع مؤقت بومودورو وموسيقى هادئة ورسائل تشجيعية">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🧠</text></svg>">

    <style>
        /* جميع أنماط CSS الأصلية تبقى كما هي بدون تغيير */
        /* ... */
    </style>
</head>
<body>
    <!-- Background Elements -->
    <div class="bg-element bg-element-1"></div>
    <div class="bg-element bg-element-2"></div>
    <div class="bg-element bg-element-3"></div>

    <!-- Particle Container -->
    <div class="particle-container" id="particles"></div>

    <!-- Notification Container -->
    <div class="notification-container" id="notifications"></div>

    <!-- Audio Player (تمت إضافته) -->
    <audio id="audio-player" hidden></audio>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo animate-breathe">
                        <i class="fas fa-brain"></i>
                    </div>
                    <div class="logo-text">
                        <h1>غرفة تركيز</h1>
                        <p>مساحتك للتركيز والإنتاجية</p>
                    </div>
                </div>
                <button class="btn btn-follow btn-3d" onclick="followUs()">
                    <i class="fab fa-github social-icon github"></i>
                    <span>تابعنا هنا</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <!-- جميع أقسام HTML الأصلية تبقى كما هي بدون تغيير -->
        <!-- ... -->
    </main>

    <script>
        // Global variables
        let timerState = {
            isRunning: false,
            currentTime: 25 * 60,
            totalTime: 25 * 60,
            isBreak: false,
            interval: null
        };

        let musicState = {
            isPlaying: false,
            currentTrack: 0,
            volume: 50
        };

        let stats = {
            completedSessions: 0,
            focusTime: 0,
            streak: 7,
            productivity: 85
        };

        // Music tracks data (تم التعديل هنا)
        const musicTracks = [
            { 
                id: 1, 
                title: 'أصوات الطبيعة', 
                duration: '3:45', 
                icon: 'fas fa-leaf', 
                iconClass: 'leaf', 
                gradient: 'linear-gradient(135deg, #10b981, #3b82f6)',
                file: 'sounds/nature_sounds.mp3'
            },
            { 
                id: 2, 
                title: 'صوت المطر', 
                duration: '5:20', 
                icon: 'fas fa-cloud-rain', 
                iconClass: 'rain', 
                gradient: 'linear-gradient(135deg, #8b5cf6, #ec4899)',
                file: 'sounds/rain_sound.mp3'
            },
            { 
                id: 3, 
                title: 'نسيم الغابة', 
                duration: '4:15', 
                icon: 'fas fa-wind', 
                iconClass: 'wind', 
                gradient: 'linear-gradient(135deg, #3b82f6, #06b6d4)',
                file: 'sounds/forest_breeze.mp3'
            },
            { 
                id: 4, 
                title: 'موجات المحيط', 
                duration: '6:30', 
                icon: 'fas fa-water', 
                iconClass: 'water', 
                gradient: 'linear-gradient(135deg, #06b6d4, #3b82f6)',
                file: 'sounds/ocean_waves.mp3'
            }
        ];

        // الحصول على عنصر audio
        const audioPlayer = document.getElementById('audio-player');

        // Motivational messages
        const motivationalMessages = [
            { text: "النجاح هو نتيجة الاستعداد والجهد والتعلم من الفشل", author: "كولن باول" },
            { text: "الطريق إلى النجاح دائماً تحت الإنشاء", author: "ليلي توملين" },
            { text: "لا تنتظر الفرصة المثالية، اصنعها", author: "جورج برنارد شو" },
            { text: "التركيز هو بداية كل إنجاز عظيم", author: "براين تريسي" },
            { text: "الانضباط هو الجسر بين الأهداف والإنجاز", author: "جيم رون" },
            { text: "إذا كنت تريد أن تحقق أشياء لم تحققها من قبل، عليك أن تفعل أشياء لم تفعلها من قبل", author: "نيلسون مانديلا" },
            { text: "النجاح لا يأتي من الراحة، بل من المثابرة والعمل الجاد", author: "دوين جونسون" },
            { text: "كل دقيقة تقضيها في التخطيط توفر عليك عشر دقائق في التنفيذ", author: "براين تريسي" }
        ];

        // Distracting websites data
        const distractingWebsites = [
            { id: 1, name: 'فيسبوك', description: 'وسائل التواصل الاجتماعي', icon: 'fab fa-facebook', iconClass: 'facebook', color: '#1877f2' },
            { id: 2, name: 'يوتيوب', description: 'مقاطع الفيديو', icon: 'fab fa-youtube', iconClass: 'youtube', color: '#ff0000' },
            { id: 3, name: 'تيك توك', description: 'فيديوهات قصيرة', icon: 'fab fa-tiktok', iconClass: 'tiktok', color: '#000000' },
            { id: 4, name: 'تويتر', description: 'شبكة اجتماعية', icon: 'fab fa-twitter', iconClass: 'twitter', color: '#1da1f2' },
            { id: 5, name: 'إنستغرام', description: 'مشاركة الصور', icon: 'fab fa-instagram', iconClass: 'instagram', color: 'linear-gradient(135deg, #f58529, #dd2a7b)' },
            { id: 6, name: 'نتفليكس', description: 'أفلام ومسلسلات', icon: 'fas fa-film', iconClass: 'netflix', color: '#e50914' }
        ];

        // Particle background animation
        function createParticles() {
            const container = document.getElementById('particles');
            
            function addParticle() {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 8 + 's';
                particle.style.animationDuration = (Math.random() * 4 + 4) + 's';
                container.appendChild(particle);

                setTimeout(() => {
                    if (container.contains(particle)) {
                        container.removeChild(particle);
                    }
                }, 12000);
            }

            for (let i = 0; i < 50; i++) {
                setTimeout(addParticle, i * 200);
            }

            setInterval(addParticle, 800);
        }

        // Timer functions
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        function updateTimerDisplay() {
            document.getElementById('timer-display').textContent = formatTime(timerState.currentTime);
            document.getElementById('timer-label').textContent = timerState.isBreak ? 'استراحة' : 'جلسة تركيز';
            
            const progress = 1 - (timerState.currentTime / timerState.totalTime);
            const circumference = 2 * Math.PI * 54;
            const offset = circumference * (1 - progress);
            document.getElementById('progress-circle').style.strokeDashoffset = offset;
        }

        function toggleTimer() {
            const btn = document.getElementById('start-pause-btn');
            const icon = btn.querySelector('i');
            const text = btn.querySelector('span');
            
            if (timerState.isRunning) {
                clearInterval(timerState.interval);
                timerState.isRunning = false;
                icon.className = 'fas fa-play';
                text.textContent = 'ابدأ';
            } else {
                timerState.isRunning = true;
                icon.className = 'fas fa-pause';
                text.textContent = 'توقف';
                
                timerState.interval = setInterval(() => {
                    timerState.currentTime--;
                    updateTimerDisplay();
                    
                    if (timerState.currentTime <= 0) {
                        clearInterval(timerState.interval);
                        timerState.isRunning = false;
                        
                        if (!timerState.isBreak) {
                            stats.completedSessions++;
                            stats.focusTime += parseInt(document.getElementById('focus-time').value);
                            updateStats();
                            showNotification('أحسنت! حان وقت الاستراحة 🎉', 'success');
                            
                            timerState.isBreak = true;
                            timerState.currentTime = parseInt(document.getElementById('break-time').value) * 60;
                            timerState.totalTime = timerState.currentTime;
                        } else {
                            showNotification('انتهت الاستراحة، استعد للتركيز!', 'info');
                            
                            timerState.isBreak = false;
                            timerState.currentTime = parseInt(document.getElementById('focus-time').value) * 60;
                            timerState.totalTime = timerState.currentTime;
                        }
                        
                        updateTimerDisplay();
                        icon.className = 'fas fa-play';
                        text.textContent = 'ابدأ';
                    }
                }, 1000);
            }
        }

        function resetTimer() {
            clearInterval(timerState.interval);
            timerState.isRunning = false;
            
            const focusTime = parseInt(document.getElementById('focus-time').value) * 60;
            const breakTime = parseInt(document.getElementById('break-time').value) * 60;
            
            timerState.currentTime = timerState.isBreak ? breakTime : focusTime;
            timerState.totalTime = timerState.currentTime;
            
            updateTimerDisplay();
            
            const btn = document.getElementById('start-pause-btn');
            btn.querySelector('i').className = 'fas fa-play';
            btn.querySelector('span').textContent = 'ابدأ';
        }

        function updateSettings() {
            if (!timerState.isRunning) {
                resetTimer();
            }
        }

        // Music functions (تم التعديل هنا)
        function toggleMusic() {
            const btn = document.getElementById('music-play-btn');
            const icon = btn.querySelector('i');
            const visualizer = document.getElementById('visualizer');
            
            if (musicState.isPlaying) {
                audioPlayer.pause();
                icon.className = 'fas fa-play';
                musicState.isPlaying = false;
            } else {
                audioPlayer.play().catch(e => console.error('Error playing audio:', e));
                icon.className = 'fas fa-pause';
                visualizer.style.display = 'flex';
                musicState.isPlaying = true;
            }
        }

        function previousTrack() {
            musicState.currentTrack = (musicState.currentTrack - 1 + musicTracks.length) % musicTracks.length;
            updateCurrentTrack();
        }

        function nextTrack() {
            musicState.currentTrack = (musicState.currentTrack + 1) % musicTracks.length;
            updateCurrentTrack();
        }

        function updateCurrentTrack() {
            const track = musicTracks[musicState.currentTrack];
            document.getElementById('current-track').textContent = track.title;
            
            audioPlayer.src = track.file;
            audioPlayer.volume = musicState.volume / 100;
            
            if (musicState.isPlaying) {
                audioPlayer.play().catch(e => console.error('Error playing audio:', e));
            }
            
            renderPlaylist();
        }

        function updateVolume() {
            musicState.volume = document.getElementById('volume').value;
            audioPlayer.volume = musicState.volume / 100;
        }

        function renderPlaylist() {
            const container = document.getElementById('playlist-container');
            container.innerHTML = '';
            
            musicTracks.forEach((track, index) => {
                const item = document.createElement('div');
                item.className = `playlist-item ${index === musicState.currentTrack ? 'active' : ''}`;
                item.onclick = () => {
                    musicState.currentTrack = index;
                    updateCurrentTrack();
                    if (!musicState.isPlaying) {
                        toggleMusic();
                    }
                };
                
                item.innerHTML = `
                    <div class="playlist-info">
                        <div class="playlist-icon" style="background: ${track.gradient};">
                            <i class="${track.icon} social-icon ${track.iconClass}"></i>
                        </div>
                        <div>
                            <p style="font-weight: 500;">${track.title}</p>
                            <p style="font-size: 12px; color: #94a3b8;">${track.duration}</p>
                        </div>
                    </div>
                    <button style="background: none; border: none; color: #8b5cf6; cursor: pointer;">
                        <i class="fas ${index === musicState.currentTrack && musicState.isPlaying ? 'fa-pause' : 'fa-play'}"></i>
                    </button>
                `;
                
                container.appendChild(item);
            });
        }

        // Motivational messages
        function newMessage() {
            const randomMessage = motivationalMessages[Math.floor(Math.random() * motivationalMessages.length)];
            document.getElementById('message-text').textContent = randomMessage.text;
            document.getElementById('message-author').textContent = `- ${randomMessage.author}`;
            
            const card = document.getElementById('message-card');
            card.style.transform = 'scale(0.95)';
            card.style.opacity = '0.7';
            setTimeout(() => {
                card.style.transform = 'scale(1)';
                card.style.opacity = '1';
            }, 200);
        }

        // Distracting websites
        function renderWebsites() {
            const container = document.getElementById('websites-list');
            container.innerHTML = '';
            
            distractingWebsites.forEach((website, index) => {
                const item = document.createElement('div');
                item.className = 'website-item';
                item.style.animationDelay = `${index * 0.1}s`;
                
                item.innerHTML = `
                    <div class="website-info">
                        <div class="website-icon" style="background: ${website.color};">
                            <i class="${website.icon} social-icon ${website.iconClass}"></i>
                        </div>
                        <div>
                            <p style="font-weight: 500;">${website.name}</p>
                            <p style="font-size: 12px; color: #94a3b8;">${website.description}</p>
                        </div>
                    </div>
                    <div style="color: #ef4444;">
                        <i class="fas fa-ban"></i>
                    </div>
                `;
                
                container.appendChild(item);
            });
        }

        // Statistics
        function updateStats() {
            document.getElementById('completed-sessions').textContent = stats.completedSessions;
            document.getElementById('focus-minutes').textContent = stats.focusTime;
            document.getElementById('streak-days').textContent = stats.streak;
            document.getElementById('productivity').textContent = stats.productivity;
            
            localStorage.setItem('focusRoom_stats', JSON.stringify(stats));
        }

        // Session sharing functions
        function saveSettings() {
            const settings = {
                focusTime: document.getElementById('focus-time').value,
                breakTime: document.getElementById('break-time').value,
                volume: musicState.volume
            };
            
            localStorage.setItem('focusRoom_settings', JSON.stringify(settings));
            showNotification('تم حفظ الإعدادات بنجاح!', 'success');
        }

        function shareSession() {
            const settings = {
                focusTime: document.getElementById('focus-time').value,
                breakTime: document.getElementById('break-time').value,
                volume: musicState.volume
            };
            
            const settingsData = encodeURIComponent(JSON.stringify(settings));
            const url = `${window.location.origin}${window.location.pathname}?settings=${settingsData}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'غرفة تركيز - إعداداتي',
                    text: 'شارك معي جلسة التركيز!',
                    url: url
                });
            } else {
                navigator.clipboard.writeText(url).then(() => {
                    showNotification('تم نسخ الرابط إلى الحافظة!', 'success');
                });
            }
        }

        function exportData() {
            const data = {
                settings: {
                    focusTime: document.getElementById('focus-time').value,
                    breakTime: document.getElementById('break-time').value,
                    volume: musicState.volume
                },
                stats: stats,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'focus-room-data.json';
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('تم تصدير البيانات بنجاح!', 'success');
        }

        function followUs() {
            window.open('https://ibrahimmustafacv.github.io/my-social-media-page/', '_blank');
        }

        // Notification system
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notifications');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle'
            };
            
            notification.innerHTML = `
                <i class="${icons[type]}"></i>
                <span>${message}</span>
            `;
            
            container.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (container.contains(notification)) {
                        container.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Load saved data
        function loadSavedData() {
            const savedSettings = localStorage.getItem('focusRoom_settings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                document.getElementById('focus-time').value = settings.focusTime || 25;
                document.getElementById('break-time').value = settings.breakTime || 5;
                document.getElementById('volume').value = settings.volume || 50;
                musicState.volume = settings.volume || 50;
            }
            
            const savedStats = localStorage.getItem('focusRoom_stats');
            if (savedStats) {
                stats = { ...stats, ...JSON.parse(savedStats) };
                updateStats();
            }
            
            const urlParams = new URLSearchParams(window.location.search);
            const sharedSettings = urlParams.get('settings');
            if (sharedSettings) {
                try {
                    const settings = JSON.parse(decodeURIComponent(sharedSettings));
                    document.getElementById('focus-time').value = settings.focusTime || 25;
                    document.getElementById('break-time').value = settings.breakTime || 5;
                    document.getElementById('volume').value = settings.volume || 50;
                    musicState.volume = settings.volume || 50;
                    showNotification('تم تحميل الإعدادات المشتركة!', 'info');
                } catch (e) {
                    console.error('Error loading shared settings:', e);
                }
            }
        }

        // Initialize the application
        function init() {
            createParticles();
            updateCurrentTrack(); // تحميل أول مسار صوتي
            renderPlaylist();
            renderWebsites();
            updateTimerDisplay();
            updateStats();
            loadSavedData();
            
            updateSettings();
            
            // إضافة مستمع لحدث انتهاء الصوت
            audioPlayer.addEventListener('ended', nextTrack);
            audioPlayer.addEventListener('error', (e) => {
                console.error('Audio error:', e);
                showNotification('حدث خطأ في تشغيل الملف الصوتي', 'error');
            });
            
            console.log('Focus Room initialized successfully!');
        }

        // Start the application when page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
